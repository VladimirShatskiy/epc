# Бот предназначен для загрузки фото/видео и документов и общения с клинентами сервиса

## Принцип работы
Бот является частью системы дилера по работе с заказ нарядами,
его задача на основании готовой базы с номерами заказ нарядов подгружать
под каждый из них требуемые материалы и отправлять фото и видео клиенту.
При этом используется весь функционал Телеграмма. т.е. все фотографии перед отправкой могут
быть отформатированы, помечены или на них выделены особые моменты на что 
стоит обратить внимание

Со стороны сотрудников сервисного центра. Есть два уровня доступа.
1) - администратор, доступ при котором можно менять уровень доступа контактов из базы, + доступ сотрудника 

2) - доступ сотрудника, возможность загружать под заказ наряды фото и видео материалы

Функционал администратора:
имеет доступ к меню администратора:
* Смена уровня доступа:
	* Каждому пользователю можно назначить уровень доступа. По умолчанию, при подключении к боту устанавливается уровень 3 (клиент). 
	Администратор может сменить тип на 2 - сотрудник, 1 - администратор
* Смена имени пользователя. 
	* Для любого пользователя можно внести имя, сам бот имя у пользователя не запрашивает. Рекомендуется внести имена для всех сотрудников сервисного центра, т.к. именно от имени из базы, а не от личного имени в телеграмме, будет вестись общение с клиентами
* Просмотр протокола беседы. 
	* Вывод протокола беседы по номеру заказ наряда
* Смена уровня "активности" пользователя. 
	* Система не удаляет пользователей из списка. Доступ к "активности" не зависит от уровня доступа.
	Например при увольнении сотрудника или отказе клиента от получения фото в бота можно установить данный признак.
	1 - пользователь активный, 
	2 - пользователь не активный ( у него блокируется доступ к Боту, в том числе при попытке вновь к нему подключиться)

Функционал сотрудника:
* команда "/ order" -  выбрать заказ наряд используя календарь или чать номера заказ наряда. Выбрать тип действия (приемка, повреждение и т.д.)
Информация о выборе заказ наряда и типе действия будет закреплена в сообщении сверху.
После выбора, можно проводить фото и видео фиксацию. Все фотографии будут автоматически отосланы клиенту ( в случае подключения клиента к боту)
если клиент не подключен, сотрудник сервиса увидит соответующее сообщение.
так, же сотрудник сервиса может вести переписку с клиентом, находясь в его заказ наряде. Все что будет написано автоматически отправляется клиенту.	
При ответе клиента, сотрудник получит сообщение с номером заказ наряда по которому ответил клиент. Это позволит не запутаться с кем сотрудник общается. 
Для дальнейшего ответа , сотруднику необходимо будет вновь "провалиться" в заказ наряд по которому ответил клиент.

### ***Есть скрытый от клиента тип действия "Для сервисных нужд" при выборе данного действия фото и видео не отправляется клиенту, остается только на сервере дилера. Переписка при этом работает в обычном режиме


Со стороны клиентов
3) - доступ клиента ограничен возможностью принимать фото и видео отчеты сотрудников сервиса и текстовых сообщений от сотрудников. 
так же клиент может отвечать на сообщения


Для подключения клиента к боту необходимо послать клиенту sms или иное сообщение с ссылкой на бота.
Клиенту необходимо подключиться к боту, нажать на кнопку старт и согласиться с передачей контактной информации (номером телефона), после чего сможет получать все материалы.

Клиент будет получать все материалы из всех подпапок к заказ наряду за исключением папки Service, в эту папку можно загружать материалы для служебного пользования, клиенту они не пересылаются (под подпапками понимается стадии ремонта автомобиля: приемка автомобиля, кузовной ремонт, кузовные повреждения и т.д.)


### Подготовка со стороны дилера
Для корректной работы бота необходимо выделить отдельную директорию в хранилище 
в которой будут содержаться папки с названиями номеров заказ нарядов. 
Для бота необходимо указать путь на директорию изменив в файле config.py
значение переменой BRANCH_PHOTO

В случае указания в имени папок помимо номера заказ наряда, регистрационного номера автомобиля(через пробел)
бот при поиске необходимой папки для размещения материалов сможет найти необходимую папку как по части
номера заказ наряда так и по части регистрационного номера автомобиля.

При закрытии заказ наряда предусмотрено два варианта
1) удалить перенести папку из директории хранилища, в этом случае бот ее просто не увидит и не сможет в нее добавить информацию
2) в конце названия папки указать специальный словом 'closed' при этом бот будет данную папку игнорировать. Данный ключ можно изменить в файле конфигурации

По каждому машинозаезду материалы могут загружаться в подпапки к заказ наряду. 
Изменить количество подпапок можно в файле config.py в переменной TYPE_ORDER (формат key:value)

Для связи с клиентом из базы дилера в каждую папку с заказ нарядом необходимо положить текстовый файл phone.txt указав в нем номер телефона цифрами без пробелов и специальных знаком. Например 7123464677

Для смены наименования организации от имени которой клиент будет получать сообщения в телеграмме необходимо скорректировать имя переменной ORGANIZATION_NAME

Предусмотрена возможность проверять заказ наряды по особому признаку. В случае закрытия заказ наряда и как следствие невозможности дальнейшего размещения в нем 
фото и видео фиксации. Предусмотрен вариант специальной пометки в окончании названии папки. В случае если в конце наименования папки добавить признак из переменой CLOSED_ORDER. Бот не будет 
работать с данной папкой. 

### Важно

При формировании календаря для выбора необходимого заказ наряда бот
смотрит дату создания папки с номером заказ наряда. Это стабильно работает на всех системах кроме linux
На Linux при изменении папки дата изменения приравнивается к дате создания, таким образом календарь бота
не будет корректно показывать созданные по датам заказ наряды

###### ***в случае вопросов готов прокомментировать shatskiy.v@inbox.ru***
